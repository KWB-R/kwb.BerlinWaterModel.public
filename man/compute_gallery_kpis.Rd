% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/compute_gallery_kpis.R
\name{compute_gallery_kpis}
\alias{compute_gallery_kpis}
\title{Compute abstraction metrics per gallery}
\usage{
compute_gallery_kpis(
  df,
  gallery_col = "gallery",
  date_col = "date",
  q_col = "cbm_per_day",
  temporal_resolution = c("auto", "daily", "monthly"),
  date_min = NULL,
  date_max = NULL
)
}
\arguments{
\item{df}{A \code{data.frame} containing at least gallery ID, date and
abstraction rates (e.g. in \eqn{m^3/d}) for a single gallery.}

\item{gallery_col}{Name of the gallery column (default: \code{"gallery"}).}

\item{date_col}{Name of the date column (default: \code{"date"}). The column
must be coercible to \code{Date}.}

\item{q_col}{Name of the abstraction column (e.g. \code{"cbm_per_day"},
interpreted as \eqn{m^3/d}).}

\item{temporal_resolution}{Character string specifying the temporal
resolution, one of \code{"auto"}, \code{"daily"} or \code{"monthly"}.
If set to \code{"auto"}, the resolution is inferred from the median time
step between consecutive dates.}

\item{date_min}{Optional start date of the observation period. If
\code{NULL} (default), the minimum of the date column is used.}

\item{date_max}{Optional end date of the observation period. If
\code{NULL} (default), the maximum of the date column is used.}
}
\value{
A named \code{list} with the following elements:
\item{per_year}{A tibble of yearly metrics per gallery and year, including
yearly volumes (e.g. \code{QA}, \code{NQMonat}, \code{HQMonat},
\code{Q365}, \code{Q1Ist}, \code{Q30}) as well as the number of months
with data (\code{n_months_with_data}), the number of months in
operation (\code{n_months_in_operation}), the length of the observation
period in months (\code{n_months_observation_period}) and the
corresponding percentages
(\code{n_months_operation_with_data_percent},
\code{n_months_operation_within_observationperiod_percent}).}
\item{per_gallery}{A tibble of aggregated metrics per gallery over the full
observation period (e.g. \code{MQA}, \code{NQA}, \code{HQA}, \code{MNQA},
\code{NNQA}, \code{MHQA}, \code{HHQA}, \code{MQ365}, \code{HQ365},
\code{MQ1Ist}, \code{MQ30}), together with
\code{n_months_with_data}, \code{n_months_in_operation},
\code{n_months_observation_period},
\code{n_months_operation_with_data_percent} and
\code{n_months_operation_within_observationperiod_percent}.}
\item{per_month}{A tibble of monthly metrics per gallery and calendar
month aggregated over all years (e.g. \code{MQMonat}, \code{NQMonat},
\code{HQMonat}), plus the number of months with data
(\code{n_months_with_data}), the number of months in operation
(\code{n_months_in_operation}), the observation-period length in months
(\code{n_months_observation_period}) and the corresponding percentages
(\code{n_months_operation_with_data_percent},
\code{n_months_operation_within_observationperiod_percent}).}
\item{meta}{A named list with meta information such as
\code{temporal_resolution}, \code{synthetic_daily_from_month},
\code{has_daily_extremes}, the vector
\code{requires_real_daily_for = c("Q1Ist", "MQ1Ist", "Q30", "MQ30")},
and the effective \code{date_min}, \code{date_max} and
\code{n_months_observation_period}.}
}
\description{
Computes yearly, monthly and aggregated abstraction metrics for a single
gallery (Brunnengalerie).
}
\details{
The function automatically detects whether daily values were synthetically
generated from monthly data, e.g. by completing a daily grid and applying
\code{tidyr::fill(direction = "up")}. In that case, all volume-based yearly
and monthly metrics are computed, but daily extreme metrics
(\code{Q1Ist}, \code{MQ1Ist}, \code{Q30}, \code{MQ30}) are suppressed and
returned as \code{NA}, because they would not represent real daily extremes.

Months with \code{NA} or zero abstraction are excluded from the calculation
of monthly-based KPIs (e.g. NQMonat, HQMonat, MQMonat). Additional size
indicators are provided: \code{n_months_with_data},
\code{n_months_in_operation} and \code{n_months_observation_period} per
gallery, as well as two percentage indicators describing the share of
operational months within the observed data and within the full observation
period.
}
